<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>注册页面</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">  
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        span{
            font-size: 18px;
        }
    </style>
</head>
<body>

    <h1 style="text-align: center; margin-top: 18%;">欢迎使用注册页面</h1>
    <div style="text-align: center; margin-top: 2%; margin-left: 40%;">
        <table style="text-align: center;">
            <tr>
                <td align="right">用户名:</td>
                <td><input type="text" name="userName" id="name" value="" placeholder="请输入2-6位汉字或者4-10位字母"></td>
                <td align="left" >
                    <span class="glyphicon glyphicon-ok" style="color:green;" id="a1"></span>
                    <span class="glyphicon glyphicon-remove" style="color:red;" id="a2"></span>
                </td>
            </tr>
            <tr>
                <td align="right">密码:</td>
                <td><input type="password" name="password" id="pwd" value="" placeholder="请输入6-13位密码"></td>
                <td align="left">
                    <span class="glyphicon glyphicon-ok" style="color:green;" id="b1"></span>
                    <span class="glyphicon glyphicon-remove" style="color:red;" id="b2"></span>
                </td>
            </tr>
            <tr>
                <td align="right">确认密码:</td>
                <td><input type="password" name="checkPwd" id="checkPwd" value="" disabled="disabled" placeholder="请再次输入密码"></td>
                <td align="left">
                    <span class="glyphicon glyphicon-ok" style="color:green;" id="c1"></span>
                    <span class="glyphicon glyphicon-remove" style="color:red;" id="c2"></span>
                </td>
            </tr>
            <tr>
                <td align="right">验证码:</td>
                <td>
                    <input type="text" name="checkNum" id="checkNum" value="" placeholder="请输入验证码" style="width: 100px; float: left; margin-left: 12px;">
                    <button class="btn btn-message btn-sm" id="get">点击获取验证码</button>
                    <button class="btn btn-message btn-sm" id="getNum" style="float: right; margin-right: 12px;"></button>
                </td>
                <td align="left">
                    <span class="glyphicon glyphicon-ok" style="color:green;" id="d1"></span>
                    <span class="glyphicon glyphicon-remove" style="color:red;" id="d2"></span>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <input type="checkbox" id="check" class="check">
                    <label for="check">我已阅读并同意<a href="#" data-toggle="modal" data-target="#myModal">XXX服务条款</a></label>
                </td>
            </tr>
            <tr>
                <td></td>
                <td><button id="button" class="btn btn-success" disabled="disabled">注册</button></td>
                <td>已有账号?立即<a href="login.html">登录</a></td>
            </tr>
        </table>
    </div>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        XXX服务条款
                    </h4>
                </div>
                <div class="modal-body">
                    <p>*</p>
                    <p>*</p>
                    <p>*</p>
                    <p>*</p>
                    <p>*</p>
                    <p>*</p>
                    <p>*</p>
                    <p>*</p>
                    <span>最终解释权归孙书彬所有!!!</span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        关闭
                    </button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="agree">
                        确认
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

    <script>

        //浏览器直接加载
        $(function(){
            $('#checkNum').hide();
            $('#getNum').hide();
            hideAll();
        })

        //隐藏全部判断符号
        function hideAll(){
            $('#a1').hide();
            $('#a2').hide();
            $('#b1').hide();
            $('#b2').hide();
            $('#c1').hide();
            $('#c2').hide();
            $('#d1').hide();
            $('#d2').hide();
        }
        //隐藏用户名判断符号
        function hideA(){
            $('#a1').hide();
            $('#a2').hide();
        }
        //隐藏密码判断符号
        function hideB(){
            $('#b1').hide();
            $('#b2').hide();
        }
        //隐藏确认密码判断符号
        function hideC(){
            $('#c1').hide();
            $('#c2').hide();
        }
        //隐藏验证码判断符号
        function hideD(){
            $('#d1').hide();
            $('#d2').hide();
        }

        //判断用户名格式
        $('#name').blur(function(){
            $('#a2').html('');
            var userNameone = /^[\u4e00-\u9fa5]{2,6}$/;
            var userNametwo = /^[A-Za-z]{4,10}$/;
            if(userNameone.test($('#name').val())||userNametwo.test($('#name').val())){
                selectUserByUserName();
            }
            if (!userNameone.test($('#name').val())&&!userNametwo.test($('#name').val())) {
                if ($('#name').val() != '') {
                    hideA();
                    $('#a2').show();
                }
            }
        })

        //判断密码格式
        $('#pwd').blur(function(){
            var passwordSize = /^[A-Za-z0-9]{6,13}$/;
            if (passwordSize.test($('#pwd').val())) {
                hideB();
                $('#b1').show();
                $('#checkPwd').attr('disabled',false);
            }
            else{
                if ($('#pwd').val() != '') {
                    hideB();
                    $('#b2').show();
                    $('#checkPwd').attr('disabled',true);
                }
            }
        })
    
        //判断密码与确认密码是否一致
        $('#checkPwd').blur(function(){
            var password = $('#pwd').val();
            var checkPwd = $('#checkPwd').val();
            if (checkPwd != '' && password == checkPwd) {
                hideC();
                $('#c1').show();
            }
            else{
                if ($('#checkPwd').val() != '') {
                    hideC();
                    $('#c2').show();
                }
            }
        })

        //生成验证码
        var code;
        function createCode(){
            //首先默认code为空字符串
            code = '';
            //设置长度为4
            var codeLength = 4;
            //设置随机字符
            var random = new Array(0,1,2,3,4,5,6,7,8,9,
                'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z');
            //循环codeLength 我设置的4就是循环4次
            for(var i = 0; i < codeLength; i++){
                //设置随机数范围,数组有36个，所以这设置为0 ~ 36(向下取整)
                var index = Math.floor(Math.random()*36);
                //字符串拼接 将每次随机的字符 进行拼接
                code += random[index]; 
            }
            //将拼接好的字符串展示给用户
            $('#getNum').html(code);
        }

        //同意条款与提交按钮联动
        $('#check').click(function(){
            if ($('#check').prop('checked') && $('#button').prop('disabled')) {
                $('#button').attr('disabled',false);
            }
            if (!$('#check').prop('checked') && !$('#button').prop('disabled')) {
                $('#button').attr("disabled",true);
            }
        })
    
        //点击获取验证码
        $('#get,#getNum').click(function(){
            createCode();
            $('#get').hide();
            $('#getNum').show();
            $('#checkNum').show();
        })

        //判断验证码是否一致
        $('#checkNum').blur(function(){
            var show = $('#getNum').html();
            var checkNum = $('#checkNum').val();
            if (checkNum != '') {
                if (show == checkNum) {
                    hideD();
                    $('#d1').show();
                }
                else{
                    hideD();
                    $('#d2').show();
                    setTimeout(function(){
                        createCode();
                    },200)
                }
            }            
        })

        //模态框同意条款事件
        $('#agree').click(function(){
            $('#check').prop('checked',true);
            $('#button').attr('disabled',false);
        })

        //提交注册按钮事件
        $('#button').click(function(){
            var userName = $('#name').val();
            var password = $('#pwd').val();
            if ($('#one').html()=='√' && $('#two').html()=='√' && $('#three').html()=='√' && $('#fore').html()=='√') {
                setTimeout(function(){
                    insertRegister();
                },100)
            }else{
                if ($('#name').val() == '') {
                    alert('请输入用户名!');
                }else{
                    if ($('#pwd').val() == '') {
                        alert('请输入密码!')
                    }else{
                        if ($('#checkPwd').val() == '') {
                            alert('请输入确认密码!')
                        }else{
                            if ($('#checkNum').val() == '') {
                                alert('请输入验证码!')
                            }
                        }
                    }
                }
            }
        })

        //根据用户名查询用户信息是否存在
        function selectUserByUserName(){
            $.ajax({
                type: 'GET',
                url: 'http://localhost:8080/checkUser',
                data: {'userName':$('#name').val()},
                success: function(result){
                    if (result == 1) {
                        hideA();
                        $('#a1').show();
                    }else{
                        hideA();
                        $('#a2').html('用户名已存在!').show();
                    }
                },
                error: function(e){
                    alert('系统错误');
                }
            })
        }

        //添加注册信息到数据库
        function insertRegister(){
            $.ajax({
                type: 'POST',
                url: 'http://localhost:8080/insertUser',
                data: {
                    'userName':$('#name').val(),
                    'password':$('#pwd').val()
                },
                success: function(result){
                    if (result == 1) {
                        alert('注册成功,即将跳转到首页');
                        $.cookie('userName',$('#name').val());
                        $(location).prop('href', 'index.html');
                    }else{
                        alert('注册失败');
                    }
                },
                error: function(e){
                    alert('系统错误');
                }
            })
        }


    </script>
    
</body>
</html>