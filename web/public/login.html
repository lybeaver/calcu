<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>登录页面</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">  
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

    <h1 style="text-align: center; margin-top: 18%;">登录页面</h1>
    <div style="text-align: center; margin-top: 2%;">
        账号:<input type="text" name="userName" id="name" value="" placeholder="请输入账号"><br>
        密码:<input type="password" name="password" id="pwd" value="" placeholder="请输入密码"><br>
        <input type="checkbox" name="free" id="free"><label for="free">7天免登录</label><br>
        <button id="button" class="btn btn-success" style="margin-top: 0px;">登录</button><br>
        没有账号?立即<a href="register.html">注册</a>
    </div>   

    <script>

        //浏览器直接加载
        $(function(){
            //如果cookie存在数据，则免登录
            freeLogin();
        })

        //免登录操作
        function freeLogin(){
            if ($.cookie('userName') != null && $.cookie('userName') != 'null') {
                setTimeout(function(){
                    $(location).prop('href', 'index.html');
                },100);
            }
        }
    
        //登录
        $('#button').click(function(){
            var userName = $('#name').val();
            var password = $('#pwd').val();
            if (userName == '') {
                alert('请输入用户名!')
            }
            if (password == '') {
                alert('请输入密码!')
            }else{
                $.ajax({
                    url: "http://localhost:8080/login",
                    type: "POST",
                    data: {
                        'userName':userName,
                        'password':password
                    },
                    success: function(data){
                        if(data == 1){
                            if ($('#free').prop("checked")) {
                                $.cookie('userName', userName, { expires: 7 });
                            }else{
                                $.cookie('userName',userName);
                                $(location).prop('href', 'index.html');
                            }
                        }else{
                            alert('登录失败');
                        }
                    },
                    error: function (e) {
                        alert('服务器错误'+e.readyState);
                    }
                })
            }

        });

    
    </script>

</body>
</html>